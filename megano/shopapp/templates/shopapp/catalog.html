{% extends "shopapp/base_main.html" %}
{% load static %}
{% block middle %}
    <div class="Middle Middle_top">
        <div class="Middle-top">
            <div class="wrap">
                <div class="Middle-header">
                    <h1>{{ category }}</h1>
                            <ul class="product-list">
                                {% for product in products %}
                                    <li class="product-item">
                                        <img class="product-image" src="{{ product.image.url }}" alt="{{ product.name }}">
                                        <div class="product-details">
                                            <h3 class="product-title">{{ product.name }}</h3>
                                            <p class="product-price">{{ product.price }}</p>
                                            <p class="product-description">{{ product.description }}</p>
                                        </div>
                                    </li>
                                {% empty %}
                                    <li>Нет товаров</li>
                                {% endfor %}

                    </ul>
                     <div class="Section-columnSection">
                        <header class="Section-header">
                            <form id="filter-form">
                            <div class="filter-group">
                                <label for="price-from">Цена от:</label>
                                <input type="number" id="price-from" name="price-from">
                            </div>
                            <div class="filter-group">
                                <label for="price-to">Цена до:</label>
                                <input type="number" id="price-to" name="price-to">
                            </div>
                            <div class="filter-group">
                                <label for="name-filter">Поиск по названию:</label>
                                <input type="text" id="name-filter" name="name-filter">
                            </div>
                            <div class="filter-group">
                                <label for="description-filter">Поиск по описанию:</label>
                                <input type="text" id="description-filter" name="description-filter">
                            </div>
                            <div class="filter-group">
                                <label for="seller-filter">Фильтр по продавцу:</label>
                                <select id="seller-filter" name="seller-filter" multiple>
                                    <option value="seller1">Продавец 1</option>
                                    <option value="seller2">Продавец 2</option>
                                    <option value="seller3">Продавец 3</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="boolean-filter">Фильтр по boolean характеристике:</label>
                                <select id="boolean-filter" name="boolean-filter">
                                    <option value="yes">Да</option>
                                    <option value="no">Нет</option>
                                    <option value="">Не учитывать</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="list-filter">Фильтр по характеристике-списку:</label>
                                <input type="checkbox" id="list-option1" name="list-filter" value="option1">
                                <label for="list-option1">Опция 1</label>
                                <input type="checkbox" id="list-option2" name="list-filter" value="option2">
                                <label for="list-option2">Опция 2</label>
                                <input type="checkbox" id="list-option3" name="list-filter" value="option3">
                                <label for="list-option3">Опция 3</label>
                            </div>
                            <button type="submit">Применить фильтры</button>
                    </form>
                    {% for contact in page_obj %}
                    <div class="Cards">
                        <div class="Card"><a class="Card-picture" href="#"><img src="{{ contact.preview.image.url }}" alt="card.jpg" /></a>
                            <div class="Card-content">
                                <strong class="Card-title"><a href="product.html">{{ contact.name }}</a>
                                </strong>
                                <div class="Card-description">
                                    <div class="Card-cost"><span class="Card-price">{{ contact.min_price }}</span>
                                    </div>
                                    <div class="Card-category">{{ contact.category.name }}
                                    </div>
                                    <div class="Card-hover"><a class="Card-btn" href="#"><img src="{% static 'assets/img/icons/card/cart.svg' %}" alt="cart.svg" /></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    <div class="Pagination">
                            <div class="Pagination-ins">
                                <a class="Pagination-element Pagination-element_prev" href="#">
                                    <img src="{% static 'assets/img/icons/prevPagination.svg' %}" alt="prevPagination.svg" /></a>
                                {% for p in page_obj.paginator.page_range %}
                                <a class="Pagination-element Pagination-element_current" href="?page={{ p }}"><span class="Pagination-text">{{ p }}</span></a>
                                {% endfor %}
                                <a class="Pagination-element Pagination-element_prev" href="#">
                                    <img src="{% static 'assets/img/icons/nextPagination.svg' %}" alt="nextPagination.svg" /></a>
                            </div>
                    </div>
                        </header>

                    <div class="Section-content">
                        <form id="sort-form">
                           <div>
                               <label for="sort-select">Сортировать по:</label>
                               <input type="radio" id="price" name="list-filter" value="price">
                               <label for="price">Цена</label>
                               <input type="radio" id="popularity" name="list-filter" value="popularity">
                               <label for="popularity">Популярность</label>
                               <input type="radio" id="novelty" name="list-filter" value="novelty">
                               <label for="novelty">Новизна</label>
                               <input type="radio" id="reviews" name="list-filter" value="reviews">
                               <label for="reviews">Отзывы</label>
                           </div>
                           <a id="apply-button" href="{% url 'shopapp:sort-products' pk=category.pk %}">Применить</a>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
<script>
    $(document).ready(function() {
    $('#filter-form').submit(function(event) {
        event.preventDefault();

        var priceFrom = $('#price-from').val();
        var priceTo = $('#price-to').val();
        var nameFilter = $('#name-filter').val();
        var descriptionFilter = $('#description-filter').val();
        var selectedSellers = $('#seller-filter').val();
        var booleanFilter = $('#boolean-filter').val();
        var selectedOptions = $('input[name="list-filter"]:checked').map(function() {
            return this.value;
        }).get();

        $.ajax({
            url: '/filter-products',
            method: 'GET',
            data: {
                priceFrom: priceFrom,
                priceTo: priceTo,
                nameFilter: nameFilter,
                descriptionFilter: descriptionFilter,
                selectedSellers: selectedSellers,
                selectedManufacturers: selectedManufacturers,
                booleanFilter: booleanFilter,
                selectedOptions: selectedOptions
            },
            success: function(response) {
                $('.product-list').html(response);
            }
        });
    });
});
</script>
<script>
    $(document).ready(function() {

      var applyButton = $('#apply-button');
      var checkboxes = $('input[name="list-filter"]');

      applyButton.click(function(event) {
        event.preventDefault();

        var url = applyButton.attr('href');
        var selectedParams = checkboxes.filter(':checked').val()

        url += '?param=' + selectedParams;

        window.location.href = url;
      });
    });
</script>
{% endblock %}
